import os
import sys


def main():
    ip_address = sys.argv[1]
    masscan_cmd = "masscan -p1-65535 %s --rate=500 -e tun0 > masscan.out" % ip_address
    os.system(masscan_cmd)
    tcp_ports = []
    udp_ports = []
    masscan_output = open("masscan.out").readlines()
    for line in masscan_output:
        if "/tcp" in line:
            tcp_ports.append(line.split(" ")[3].split("/")[0])
        elif "/udp" in line:
            udp_ports.append(line.split(" ")[3].split("/")[0])
    
    if len(tcp_ports) > 0:
        port_string = ",".join(tcp_ports)
        cmd = "nmap -v -sC -sV -p %s %s -oN nmap.out" % (port_string, ip_address)
        os.system(cmd)



if __name__ == "__main__":
    main()